@using SchoolBones
@using SchoolBones.DataStructs
@using SchoolBones.Enums
@using SchoolBones.Common

@model List<StudentCurrentInfo>
@{
    int iEnrollId = 0;
    StudentCurrentInfo oStd = null;
    List<StudentCurrentInfo> lstStudentCurrentInfo = Model;
}

<div class="row">
    @Html.Partial("_HeaderNavigation", new DoubleInt(Id: (int)Modules.Teacher, Value: (int)SubModule.PerDeleteStudent))

    <div class="row">
        <input type="button" class="btn-outline-danger" value="Delete Selected" onclick="DeleteSelectedStdPermanently()" />
    </div>
    <div class="row">
        <table class="ReportTable">
            <thead>
                <tr>
                    <th>Std Id</th>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Year</th>
                    <th>Delete Student</th>
                </tr>
            </thead>
            <tbody id="">
                @{
                    if (lstStudentCurrentInfo != null)
                    {
                        for (int iRow = 0; iRow < lstStudentCurrentInfo.Count; iRow++)
                        {
                            oStd = lstStudentCurrentInfo[iRow];
                            <tr>
                                <td>@oStd.StdId</td>
                                <td>@oStd.StdName</td>
                                <td>@oStd.Class</td>
                                <td>@oStd.Year</td>
                                <td>
                                    @{
                                        if (iEnrollId != oStd.StdId)
                                        {
                                            iEnrollId = oStd.StdId;
                                            <input class="form-check-input" type="checkbox" id="@oStd.StdId" onclick="GetStdIds(this)">
                                        }
                                    }
                                </td>
                            </tr>
                                            }
                                        }
                }
            </tbody>
        </table>
    </div>
</div>


<script>

    var arrIdStatusPair = [];

    function GetStdIds(ele) {
        debugger;
        var IdStatusPair = {};
        var iStdId = parseInt(ele.id);
        var bChecked = ele.checked;


        if (ele.checked) {
            IdStatusPair.ID = iStdId;
            IdStatusPair.Status = bChecked;
            arrIdStatusPair.push(IdStatusPair);
        } else {
            var i = 0;
            for (; i < arrIdStatusPair.length; i++) {
                if (iStdId == arrIdStatusPair[i].ID)
                    break;
            }
            arrIdStatusPair.splice(i, 1);
        }
    }
    function DeleteSelectedStdPermanently() {
        debugger
        var url = "@Url.Action("DeleteStudentPermanently", "Teacher")";
        $.ajax({
            url: url,
            cache: false,
            type: "POST",
            dataType: "json",
            data: { arrIdStatusPair: arrIdStatusPair }, ///pending
            success: function (data) {
                successDeleteSelectedStd(true, data);
            }
        });
    }
    function successDeleteSelectedStd(bSuccess, data) {
        if (data.iStatus > 0) {
            alert("saved")
        }
        else {
            alert("!saved")
        }
    }
</script>
